<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stark Industries - Security Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@5/bundles/stomp.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0"></script>
    <script>
        (function registerStreaming(){
            try {
                if (!window.Chart) {
                    console.warn('‚ö†Ô∏è Chart.js no est√° disponible a√∫n, no se registra el plugin');
                    return;
                }
                const candidates = [
                    window['chartjs-plugin-streaming'],
                    window.chartjsPluginStreaming,
                    window.ChartStreaming,
                    window.ChartStreamingPlugin,
                ].filter(Boolean);

                let registered = false;
                for (const mod of candidates) {
                    const scale = mod.RealTimeScale || mod.realtimeScale || window.RealTimeScale;
                    const plugin = mod.StreamingPlugin || mod.default || mod;
                    try {
                        if (scale) window.Chart.register(scale);
                        if (plugin) window.Chart.register(plugin);
                        console.log('‚úÖ chartjs-plugin-streaming registrado');
                        registered = true;
                        break;
                    } catch (e) {
                        console.warn('‚ö†Ô∏è Fall√≥ el registro del plugin/escala de streaming:', e);
                    }
                }
                if (!registered) {
                    // Intento de respaldo: si la escala ya existe, no avisar como error
                    const hasRealtime = !!(window.Chart.registry && window.Chart.registry.getScale && window.Chart.registry.getScale('realtime'));
                    if (!hasRealtime) console.warn('‚ö†Ô∏è No se pudo registrar chartjs-plugin-streaming');
                    else console.log('‚ÑπÔ∏è Escala realtime ya estaba registrada');
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è Excepci√≥n registrando chartjs-plugin-streaming:', e);
            }
        })();
    </script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
</head>
<body>
<header class="header">
    <div class="brand">
        <div class="brand-mark"></div>
        <h1>STARK INDUSTRIES</h1>
    </div>
    <div class="subtitle">Sistema de Seguridad v1.0</div>
    <div id="logoutContainer" class="logout hidden">
        <button id="logoutBtn" onclick="logout()" class="btn btn-danger">Cerrar sesi√≥n</button>
    </div>
</header>

<section id="loginSection" class="login-section">
    <h2>Acceso</h2>
    <label for="username">Usuario</label>
    <input type="text" id="username" value="admin" placeholder="Usuario">
    <label for="password">Contrase√±a</label>
    <input type="password" id="password" value="admin123" placeholder="Contrase√±a">
    <button id="loginBtnSubmit" class="btn btn-primary">Iniciar sesi√≥n</button>
    <div id="loginError" class="help error"></div>
    <div class="help">Usuarios: admin/admin123 ¬∑ jarvis/jarvis123</div>
</section>

<main id="dashboardSection" class="hidden">
    <section class="grid">
        <article class="card">
            <h3>Estad√≠sticas</h3>
            <div class="metric"><span>Eventos Procesados</span><span id="totalEvents" class="metric-value">0</span></div>
            <div class="metric"><span>Eventos Cr√≠ticos</span><span id="criticalEvents" class="metric-value">0</span></div>
            <div class="metric"><span>Alertas Activas</span><span id="activeAlerts" class="metric-value">0</span></div>
        </article>

        <article class="card">
            <h3>Sensores por Tipo</h3>
            <div class="metric"><span>Movimiento</span><span id="motionEvents" class="metric-value">0</span></div>
            <div class="metric"><span>Temperatura</span><span id="tempEvents" class="metric-value">0</span></div>
            <div class="metric"><span>Acceso</span><span id="accessEvents" class="metric-value">0</span></div>
        </article>

        <article class="card span-2">
            <h3>Alertas</h3>
            <div id="alertsContainer" class="alerts-container">
                <p class="muted">Esperando eventos...</p>
            </div>
        </article>
    </section>

    <section class="grid">
        <article class="card">
            <h3>üå°Ô∏è Temperaturas</h3>
            <div class="chart-frame">
                <canvas id="temperatureChart"></canvas>
            </div>
        </article>

        <article class="card">
            <h3>üë§ Movimiento</h3>
            <div class="chart-frame">
                <canvas id="motionChart"></canvas>
            </div>
        </article>

        <article class="card">
            <h3>üîê Accesos</h3>
            <div class="chart-frame">
                <canvas id="accessChart"></canvas>
            </div>
        </article>
    </section>
</main>

<script src="js/app.js"></script>
</body>
</html>
